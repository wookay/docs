<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>DataFlow ë²„í‹°ìŠ¤(vertices) Â· ğŸ¦‰</title><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-6977995344550016",
          enable_page_level_ads: true
     });
</script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>ğŸ¦‰</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../">Home</a></li><li><span class="toctext">Flux âœ…</span><ul><li><a class="toctext" href="../../Flux/">Flux í™ˆ</a></li><li><span class="toctext">ëª¨ë¸ ë§Œë“¤ê¸°</span><ul><li><a class="toctext" href="../../Flux/models/basics/">ê¸°ë³¸ì ì¸ ê²ƒ</a></li><li><a class="toctext" href="../../Flux/models/recurrence/">ìˆœí™˜(Recurrence)</a></li><li><a class="toctext" href="../../Flux/models/regularisation/">ì •ê·œí™”(Regularisation)</a></li><li><a class="toctext" href="../../Flux/models/layers/">ëª¨ë¸ ì°¸ì¡°(Model Reference)</a></li></ul></li><li><span class="toctext">ëª¨ë¸ í›ˆë ¨ì‹œí‚¤ê¸°</span><ul><li><a class="toctext" href="../../Flux/training/optimisers/">ìµœì í™”</a></li><li><a class="toctext" href="../../Flux/training/training/">í›ˆë ¨ì‹œí‚¤ê¸°</a></li></ul></li><li><a class="toctext" href="../../Flux/data/onehot/">ì›-í•« ì¸ì½”ë”©</a></li><li><a class="toctext" href="../../Flux/gpu/">GPU ì§€ì›</a></li><li><a class="toctext" href="../../Flux/saving/">ì €ì¥ &amp; ë¶ˆëŸ¬ì˜¤ê¸°</a></li><li><a class="toctext" href="../../Flux/community/">ì»¤ë®¤ë‹ˆí‹°</a></li></ul></li><li><span class="toctext">DataFlow âœ…</span><ul><li class="current"><a class="toctext" href>DataFlow ë²„í‹°ìŠ¤(vertices)</a><ul class="internal"><li><a class="toctext" href="#ë°ì´í„°-êµ¬ì¡°-1">ë°ì´í„° êµ¬ì¡°</a></li><li><a class="toctext" href="#ì•Œê³ ë¦¬ì¦˜-1">ì•Œê³ ë¦¬ì¦˜</a></li></ul></li></ul></li><li><span class="toctext">MacroTools</span><ul><li><a class="toctext" href="../../MacroTools/README/">MacroTools README</a></li></ul></li><li><span class="toctext">FluxJS</span><ul><li><a class="toctext" href="../../FluxJS/README/">FluxJS README</a></li></ul></li><li><span class="toctext">Vinyl</span><ul><li><a class="toctext" href="../../Vinyl/README/">Vinyl README</a></li></ul></li><li><span class="toctext">GSoC</span><ul><li><a class="toctext" href="../../soc/guidelines/">Application Guidelines</a></li><li><a class="toctext" href="../../soc/projects/ml/">Data Science &amp; Machine Learning</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>DataFlow âœ…</li><li><a href>DataFlow ë²„í‹°ìŠ¤(vertices)</a></li></ul><a class="edit-page" href="https://github.com/wookay/Owl.jl/blob/master/docs/src/DataFlow/vertices.md"><span class="fa">ï‚›</span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>DataFlow ë²„í‹°ìŠ¤(vertices)</span><a class="fa fa-bars" href="#"></a></div></header><p>ğŸ¦‰  <a href="https://github.com/MikeInnes/DataFlow.jl/blob/master/docs/vertices.md">https://github.com/MikeInnes/DataFlow.jl/blob/master/docs/vertices.md</a> ë²ˆì—­</p><p>DataFlowê°€ í•˜ëŠ” ë‘ê°€ì§€:</p><ul><li><p>ê·¸ë˜í”„ ë°ì´í„° êµ¬ì¡°(a graph data structure)</p></li><li><p>ê·¸ë˜í”„ë¥¼ ê¸°ìˆ í•˜ê¸° ìœ„í•œ ê³µí†µ ë¬¸ë²•(a common syntax for describing graphs)</p></li></ul><p>ì„œë¡œ ì–¶ë§¤ì—¬ ìˆì§€ ì•Šìœ¼ë‹ˆ í¸í•˜ê²Œ ì“°ë©´ ëœë‹¤;  ì˜ˆë¥¼ ë“¤ì–´, ì´ ë¬¸ë²•ìœ¼ë¡œ ë§Œë“  ê·¸ë˜í”„ë¥¼ ì¸ì ‘ í–‰ë ¬(an adjacency matrix)ë¡œ ë³€í™˜í•˜ì—¬ ì²˜ë¦¬í•œë‹¤ê±°ë‚˜ DataFlowì˜ ê³µí†µ ê·¸ë˜í”„ ì—°ì‚° ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™œìš©í•˜ì—¬ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ê·¸ë˜í”„ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤.</p><p>DataFlowëŠ” ëª…ì‹œì ìœ¼ë¡œ ë°ì´í„° êµ¬ì¡°ë¥¼ ë‹¨ìˆœí•˜ê²Œ ìœ ì§€í•˜ê³ , ë‹¤ë¥¸ ì–´ë– í•œ ì˜ë¯¸ë„ ë§ë¶™ì´ì§€ ì•ŠëŠ”ë‹¤. ê·¸ë˜í”„ëŠ” ë°˜ë“¯í•œ ì¤„ë¦¬ì•„ í”„ë¡œê·¸ë¨, ë² ì´ì‹œì•ˆ ë„¤íŠ¸ì›Œí¬, ë˜ëŠ” ì „ê¸° íšŒë¡œì™€ ê°™ì€ ê²ƒì„ í‘œí˜„í•  ìˆ˜ ìˆë‹¤. (Fluxì™€ ê°™ì€) DataFlowë¥¼ ì‚¬ìš©í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë¬¸ë²•ì„ í™•ì¥í•  ìˆ˜ ìˆê¸°ë¥¼ ì›í•˜ë©° ì‘ìš© í”„ë¡œê·¸ë¨ì— ì ì ˆí•œ ì½”ë“œë¥¼ ìƒì„±ì‹œí‚¤ëŠ” ê·¸ë˜í”„ë¥¼ ë‹¤ë£° ê²ƒì´ë‹¤.</p><h2><a class="nav-anchor" id="ë°ì´í„°-êµ¬ì¡°-1" href="#ë°ì´í„°-êµ¬ì¡°-1">ë°ì´í„° êµ¬ì¡°</a></h2><p>DataFlowëŠ” <code>DVertex</code>ì™€ <code>IVertex</code>ë¼ëŠ” ë‘ ê°œì˜ ë°ì´í„° êµ¬ì¡°ê°€ ìˆë‹¤.  ë‘˜ì€ ê·¸ë˜í”„ì˜ ë…¸ë“œ(nodes)ê°€ ë‹¤ë¥¸ ë…¸ë“œì™€  ì…ë ¥/ì¶œë ¥(inputs/outputs)ì´ ì–´ë””ë¡œ/ì–´ë””ì—ì„œ(to/from)  ì´ë¤„ì§ˆ ê²ƒì¸ì§€ í‘œí˜„í•œë‹¤. <code>IVertex</code>ëŠ” ë§í¬ë“œ ë¦¬ìŠ¤íŠ¸(a linked list) ì²˜ëŸ¼ ì…ë ¥-ì—°ê²°(input-linked) ì´ë‹¤ - ì…ë ¥ìœ¼ë¡œ   ì‚¬ìš©ë˜ëŠ” ë…¸ë“œì— ëŒ€í•œ ì°¸ì¡°(a reference)ë¥¼ ìœ ì§€í•œë‹¤. <code>DVertex</code>ëŠ” ì´ì¤‘ìœ¼ë¡œ ì—°ê²°í•œ ê²ƒìœ¼ë¡œ ë”ë¸”-ë§í¬ë“œ ë¦¬ìŠ¤íŠ¸(doubly-linked list)ì— í•´ë‹¹í•œë‹¤ - ì…ë ¥ê³¼ ì´ê²ƒì„ ì…ë ¥ìœ¼ë¡œ ê°–ëŠ” ëª¨ë“  ë…¸ë“œë¥¼ ì°¸ì¡°í•œë‹¤. DVertexëŠ” ê¸°ìˆ ì ìœ¼ë¡  í‘œí˜„ë ¥ì´ ë” ì¢‹ì§€ë§Œ ì‘ì—…í•˜ê¸°ë„ ë” ë¹¡ì„¸ë‹ˆê¹Œ, ê°€ëŠ¥í•˜ë‹¤ë©´ ì…ë ¥-ì—°ê²°(input-linked)ë¡œ ë°”ê¿”ì„œ ì“°ëŠ”ê²Œ ìµœì„ ì´ë‹¤ (<code>DataFlow.il()</code>ë¡œ í•  ìˆ˜ ìˆë‹¤).</p><pre><code class="language-julia"># src/graph/graph.jl
abstract type Vertex{T} end

# src/graph/ilgraph.jl
struct IVertex{T} &lt;: Vertex{T}
  value::T
  inputs::Vector{IVertex{T}}
  # outputs::Set{IVertex{T}} # DVertexëŠ” ìš”ê±¸ ì¶”ê°€
end</code></pre><p><code>IVertex</code>ëŠ” ì¤„ë¦¬ì•„ì˜ <code>Expr</code> ê°ì²´ì™€ ìœ ì‚¬í•˜ë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ë‹¤ìŒê³¼ ê°™ì´ í‘œí˜„ì‹ <code>x+length(xs)</code> ë¥¼ ë¹„ìŠ·í•œ ë°©ì‹ìœ¼ë¡œì„œ ì €ì¥í•œë‹¤.</p><pre><code class="language-julia-repl">julia&gt; using DataFlow

julia&gt; x = 2
2

julia&gt; Expr(:call, :+, x, Expr(:call, :length, :xs))
:(2 + length(xs))

julia&gt; IVertex(:+, IVertex(:x), IVertex(:length, IVertex(:xs)))
IVertex{Symbol}(x() + length(xs()))</code></pre><p>ì£¼ìš”í•œ ì°¨ì´ëŠ” <em>ê°ì²´ ì•„ì´ë´í‹°í‹°(object identity)</em>ê°€ DataFlow ê·¸ë˜í”„ì—ì„œëŠ” ì¤‘ìš”í•˜ë‹¤ëŠ” ê²ƒì´ë‹¤. ë‹¤ìŒê³¼ ê°™ì´ êµ¬ë¬¸ í‘œí˜„ íŠ¸ë¦¬(an expression tree)ë¥¼ ë§Œë“¤ë©´:</p><pre><code class="language-julia-repl">julia&gt; foo = Expr(:call, :length, :xs)
:(length(xs))

julia&gt; Expr(:call, :+, foo, foo)
:(length(xs) + length(xs))</code></pre><p><code>length(xs)</code> í‘œí˜„ì‹ì„ ì¬ì‚¬ìš© í–ˆìŒì—ë„ <code>length(xs)+length(xs)</code>ë¥¼ ì¶œë ¥í•œë‹¤. DataFlowì˜ ì¬ì‚¬ìš©ì€ í° ì°¨ì´ê°€ ìˆë‹¤:</p><pre><code class="language-julia-repl">julia&gt; g = IVertex{Any}
IVertex

julia&gt; g(:+, g(:length, g(:xs)), g(:length, g(:xs)))
IVertex(length(xs()) + length(xs()))

julia&gt; foo = g(:length, g(:xs))
IVertex(length(xs()))

julia&gt; g(:+, foo, foo)
IVertex(
eland = length(xs())
eland + eland)</code></pre><p>ì¬ì‚¬ìš© í•œ ê²ƒì´ í”„ë¡œê·¸ë¨ ê·¸ë˜í”„ì— ì¸ì½”ë“œ ë˜ì—ˆë‹¤. ìœ„ì˜ ë°ì´í„° êµ¬ì¡°ì—ì„œëŠ” &quot;ë³€ìˆ˜&quot; ê°œë…ì´ ì—†ëŠ”ë° ë°ì´í„°ì˜ íë¦„ì´ ì§ì ‘ í‘œí˜„ë˜ì—ˆê¸° ë•Œë¬¸ì´ë‹¤; ëŒ€ì‹  ë¬¸ë²• ë³€í™˜ì—ì„œ ë³€ìˆ˜ê°€ í•„ìš”í•´ì§€ë©´ ê·¸ ë•Œ ìƒì„±ë  ê²ƒì´ë‹¤.</p><h2><a class="nav-anchor" id="ì•Œê³ ë¦¬ì¦˜-1" href="#ì•Œê³ ë¦¬ì¦˜-1">ì•Œê³ ë¦¬ì¦˜</a></h2><p>DataFlow ê·¸ë˜í”„ë¥¼ ë‹¤ë£¨ëŠ” ê¸°ë³¸ ì ‘ê·¼ ë°©ì‹ì€ í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°ì—ì„œ íŠ¸ë¦¬(tree)ë¥¼ ë‹¤ë£¨ëŠ” í…Œí¬ë‹‰ê³¼ ê°™ì€ ê²ƒì„ ì‚¬ìš©í•œë‹¤. ê·¸ëŸ¬ë‹ˆê¹Œ, ì¬ê·€ì ìœ¼ë¡œ(recursively) ì´ì „ ê²ƒì„ ë°Ÿì•„ë‚˜ê°€ë©° ìƒˆë¡œìš´ ê·¸ë˜í”„ë¥¼ ìƒì„±í•˜ëŠ” ì•Œê³ ë¦¬ì¦˜ì„ ë§Œë“¤ë„ë¡ í•˜ì. ê·¸ë˜í”„ì— ìˆëŠ” ê° ë…¸ë“œì— íŠ¹ì • í•¨ìˆ˜ë¥¼ ì ìš©(apply) ì‹œí‚¤ëŠ” í•¨ìˆ˜ë¡œì„œ, <code>prewalk</code> ì™€ <code>postwalk</code> ê°™ì€ê²Œ íŒ¨í‚¤ì§€ì— ë“¤ì–´ ìˆë‹¤.</p><p>ì˜ˆë¥¼ ë³´ì:</p><pre><code class="language-julia-repl">julia&gt; using DataFlow: postwalk, value

julia&gt; foo = g(:+, g(:length, g(:xs)), g(:length, g(:ys)))
IVertex(length(xs()) + length(ys()))

julia&gt; postwalk(foo) do v
         value(v) == :length &amp;&amp; value(v[1]) == :xs ? g(:lx) : v
       end
IVertex(lx() + length(ys()))</code></pre><p>(<code>pre</code>- ì™€ <code>postwalk</code>ì˜ ì°¨ì´ëŠ” ìˆœíšŒ(traversal)í•˜ëŠ” ìˆœì„œì— ìˆë‹¤. <code>@show</code> ë¥¼ í†µí•´ì„œ ë³¼ ìˆ˜ ìˆë‹¤.) ì´ ë°©ë²•ìœ¼ë¡œ ê·¸ë˜í”„ì—ì„œ ì°¾ê¸°(find), ë°”ê¾¸ê¸°(replace) ê°™ì€ ê²ƒì„ í•˜ê±°ë‚˜, ë”ìš± ë³µì¡í•œ êµ¬ì¡° ë³€í™˜ì— ì ìš©í•  ìˆ˜ ìˆë‹¤. ê·¸ëŸ¼ ì´ì œ ê³µí†µ ë¶€ë¶„ í‘œí˜„ì‹ ì œê±°(cse, common subexpression elimination)ë¥¼ í•˜ëŠ” ê¸°ë³¸ì ì¸ ë°©ë²•ì„ ì€ì—° ì¤‘ì— í„°ë“í–ˆìœ¼ë‹ˆ í•œë²ˆ êµ¬í˜„í•´ ë³´ì:</p><pre><code class="language-julia-repl">julia&gt; cse(v::IVertex, cache = Dict()) =
         postwalk(x -&gt; get!(cache, x, x), v)
cse (generic function with 2 methods)</code></pre><p>(ì—­ì£¼: <code>get!</code>ì€ ì‚¬ì „(Dict)ì— ì—†ëŠ” í‚¤ë¥¼ ì €ì¥í•œë‹¤.)</p><pre><code class="language-julia-repl">julia&gt; d = Dict(&quot;a&quot;=&gt;1, &quot;b&quot;=&gt;2, &quot;c&quot;=&gt;3);

julia&gt; get!(d, &quot;a&quot;, 5)
1

julia&gt; get!(d, &quot;d&quot;, 4)
4

julia&gt; d
Dict{String,Int64} with 4 entries:
  &quot;c&quot; =&gt; 3
  &quot;b&quot; =&gt; 2
  &quot;a&quot; =&gt; 1
  &quot;d&quot; =&gt; 4</code></pre><p>ê·¸ë˜í”„ì˜ ê° ë…¸ë“œê°€ ì‚¬ì „(Dict) íƒ€ì…ì— ëŒì–´ë“¤ì´ê³  ê°’ë“¤ì€ ìê¸° ìì‹ ì„ ì°¸ì¡°(refer) í•œë‹¤. ì´ê²ƒìœ¼ë¡œ ê²°ê³¼ ê·¸ë˜í”„ì˜ ì–´ëŠ ê°’ì´ë“  <code>==</code>ëŠ” <code>===</code>ì™€ ë§ˆì°¬ê°€ì§€ì¸ê²Œ (<code>===</code>ëŠ” identical ë¹„êµ) í™•ì‹¤í•´ì§€ë©°, ê³µí†µ í‘œí˜„ì‹ì€ ì¬ì‚¬ìš©ëœë‹¤.</p><pre><code class="language-julia-repl">julia&gt; foo = @flow length(xs)+length(xs)
IVertex(length(xs) + length(xs))

julia&gt; cse(foo)
IVertex(
eland = length(xs)
eland + eland)</code></pre><p>ì¼ë°˜ì ìœ¼ë¡œ DataFlowì˜ <code>postwalk</code>ì™€ ê°™ì€ ê³ ê¸‰ ì—°ì‚°ì— ëŠ¥ìˆ™í•´ì•¼ í•˜ì§€ë§Œ, ì–´ë–¤ ê²½ìš°ì—ëŠ” ì²˜ìŒë¶€í„° ì¬ê·€ ì•Œê³ ë¦¬ì¦˜ì„ ì§ì ‘ ì§œì•¼ í•  ë•Œë„ ìˆë‹¤. íŠ¸ë¦¬(a tree)ì— ì ìš©í•˜ëŠ” ì•Œê³ ë¦¬ì¦˜ê³¼ ê°™ì•„ ë³´ì´ì§€ë§Œ ì£¼ì˜ ì‚¬í•­ì´ ìˆëŠ”ë° (1) ë™ì¼í•œ ë…¸ë“œ(identical nodes)ê°€ íŠ¸ë¦¬ì—ì„œ ì—¬ëŸ¬ ë²ˆ ë„ë‹¬í•  ìˆ˜ ìˆë‹¤. (2) ì¬ê·€í•˜ë‹¤ ê·¸ë˜í”„ì—ì„œ ì‚¬ì´í´(cyle)ì´ ë°œìƒí•˜ì—¬ ë¬´í•œ ë£¨í”„ì— ë¹ ì§ˆ ìˆ˜ ìˆë‹¤.</p><p>ì˜ëª»í•˜ë©´ ì•…ëª½ì²˜ëŸ¼ ë³´ì´ì§€ë§Œ ì‚¬ì‹¤ì€ ì¼ì„ì´ì¡°ì¸ ê²ƒì´; í•¨ìˆ˜ë¥¼ memoize í•˜ì—¬ ë…¸ë“œë¥¼ ë°˜ë³µí•´ì„œ ë°©ë¬¸í•˜ë©´ ì¬ê·€ë¥¼ ëë‚´ê²Œ í•˜ì. ê·¸ë¦¬ê³  ì¬ê·€í•˜ê¸° <em>ì „</em>ì—ëŠ” í˜„ì¬ í˜¸ì¶œì˜ ê²°ê³¼ë¥¼ ê¼­ ìºì‹œ(cache) í•˜ë„ë¡ í•œë‹¤.</p><pre><code class="language-julia-repl">julia&gt; using DataFlow: value, inputs, thread!

julia&gt; function replace_xs(g, cache = ObjectIdDict())
         # ì´ ë…¸ë“œë¥¼ ì´ë¯¸ ì²˜ë¦¬í•œ ê²½ìš°ì—ëŠ” ë¹ ë¥¸ ì¢…ë£Œ
         haskey(cache, g) &amp;&amp; return cache[g]
         # ìƒˆë¡œìš´ (ë¹„ì–´ìˆëŠ”) ë…¸ë“œë¥¼ ë§Œë“¤ê³  ìºì‹œ í•´ ë‘ 
         cache[g] = gâ€² = typeof(g)(value(g) == :xs ? :foo : value(g))
         # ì›ë˜ ë…¸ë“œì˜ ì…ë ¥ì€ ì²˜ë¦¬í•˜ê³  ê²°ê³¼ë¥¼ ìƒˆë¡œìš´ ë…¸ë“œì— ì¶”ê°€
         thread!(gâ€², (replace_xs(v, cache) for v in inputs(g))...)
       end
replace_xs (generic function with 2 methods)

julia&gt; foo = DataFlow.cse(@flow length(xs)+length(xs))
IVertex(
alligator = length(xs)
alligator + alligator)

julia&gt; replace_xs(foo)
IVertex(
alligator = length(xs)
alligator + alligator)</code></pre><p>ì—¬ê¸°ì„œëŠ” ìºì‹œí•˜ëŠ” ê²ƒì„ ìŠì–´ë„ <code>length(foo)+length(foo)</code> í•˜ë‹¤ ë§í•˜ì§„ ì•ŠëŠ”ë°, ë‹¤ë¥¸ ê²½ìš°ì—ëŠ” ë„ì¤‘ì— ë©ˆì¶œ ìˆ˜ ìˆë‹¤.</p><p>ğŸ¦‰  ë²ˆì—­ ì™„ë£Œ 2018-03-15</p><footer><hr/><a class="previous" href="../../Flux/community/"><span class="direction">Previous</span><span class="title">ì»¤ë®¤ë‹ˆí‹°</span></a><a class="next" href="../../MacroTools/README/"><span class="direction">Next</span><span class="title">MacroTools README</span></a></footer></article></body></html>
